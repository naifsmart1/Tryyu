<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Scanner</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 100%;
      padding: 40px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .icon {
      width: 64px;
      height: 64px;
      background: #eef2ff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .icon svg {
      width: 32px;
      height: 32px;
      stroke: #667eea;
    }

    h1 {
      font-size: 32px;
      color: #1f2937;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #6b7280;
      font-size: 16px;
    }

    #video-container {
      position: relative;
      width: 100%;
      margin-bottom: 20px;
      border-radius: 12px;
      overflow: hidden;
      background: #f3f4f6;
    }

    #video {
      width: 100%;
      display: block;
      border-radius: 12px;
    }

    #video.hidden {
      display: none;
    }

    #canvas {
      display: none;
    }

    .placeholder {
      padding: 80px 20px;
      text-align: center;
      color: #9ca3af;
    }

    .placeholder svg {
      width: 64px;
      height: 64px;
      margin: 0 auto 15px;
      stroke: #d1d5db;
    }

    .alert {
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      align-items: start;
    }

    .alert svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .alert-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #991b1b;
    }

    .alert-error svg {
      stroke: #dc2626;
    }

    .alert-warning {
      background: #fffbeb;
      border: 1px solid #fde68a;
      color: #92400e;
    }

    .alert-warning svg {
      stroke: #f59e0b;
    }

    .alert-success {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #166534;
    }

    .alert-success svg {
      stroke: #16a34a;
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .alert-text {
      font-size: 14px;
      word-break: break-all;
    }

    .button {
      width: 100%;
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }

    .button-primary {
      background: #667eea;
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
    }

    .button-primary:hover {
      background: #5568d3;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .button-danger {
      background: #ef4444;
      box-shadow: 0 4px 14px rgba(239, 68, 68, 0.4);
    }

    .button-danger:hover {
      background: #dc2626;
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .footer-text {
      text-align: center;
      font-size: 12px;
      color: #9ca3af;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </div>
      <h1>QR Scanner</h1>
      <p class="subtitle">Scan a QR code to auto-redirect</p>
    </div>

    <div id="video-container">
      <video id="video" autoplay playsinline class="hidden"></video>
      <div id="placeholder" class="placeholder">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <p>Camera preview will appear here</p>
      </div>
      <canvas id="canvas"></canvas>
    </div>

    <div id="error-alert" class="alert alert-error hidden">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div class="alert-content">
        <p id="error-text" class="alert-text"></p>
      </div>
    </div>

    <div id="warning-alert" class="alert alert-warning hidden">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
      </svg>
      <div class="alert-content">
        <p class="alert-title">Scanned Content:</p>
        <p id="warning-text" class="alert-text"></p>
      </div>
    </div>

    <div id="success-alert" class="alert alert-success hidden">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div class="alert-content">
        <p class="alert-title">Redirecting...</p>
        <p id="success-text" class="alert-text"></p>
      </div>
    </div>

    <button id="scan-btn" class="button button-primary">Start Scanning</button>

    <p class="footer-text">Point your camera at a QR code containing a URL</p>
  </div>

  <script>
    let stream = null;
    let scanning = false;
    let scanInterval = null;

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const scanBtn = document.getElementById('scan-btn');
    const placeholder = document.getElementById('placeholder');
    const errorAlert = document.getElementById('error-alert');
    const warningAlert = document.getElementById('warning-alert');
    const successAlert = document.getElementById('success-alert');
    const errorText = document.getElementById('error-text');
    const warningText = document.getElementById('warning-text');
    const successText = document.getElementById('success-text');

    function isValidURL(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }

    function hideAllAlerts() {
      errorAlert.classList.add('hidden');
      warningAlert.classList.add('hidden');
      successAlert.classList.add('hidden');
    }

    function showError(message) {
      hideAllAlerts();
      errorText.textContent = message;
      errorAlert.classList.remove('hidden');
    }

    function showWarning(message) {
      hideAllAlerts();
      warningText.textContent = message;
      warningAlert.classList.remove('hidden');
    }

    function showSuccess(message) {
      hideAllAlerts();
      successText.textContent = message;
      successAlert.classList.remove('hidden');
    }

    function scanQRCode() {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);

        if (code) {
          const scannedData = code.data;
          
          if (isValidURL(scannedData)) {
            showSuccess(scannedData);
            stopScanning();
            scanBtn.disabled = true;
            
            setTimeout(() => {
              window.location.href = scannedData;
            }, 1500);
          } else {
            showWarning(scannedData);
            showError('QR code does not contain a valid URL');
            stopScanning();
          }
        }
      }
    }

    async function startScanning() {
      try {
        hideAllAlerts();
        
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });

        video.srcObject = stream;
        video.classList.remove('hidden');
        placeholder.classList.add('hidden');
        scanning = true;
        scanBtn.textContent = 'Stop Scanning';
        scanBtn.classList.remove('button-primary');
        scanBtn.classList.add('button-danger');

        scanInterval = setInterval(scanQRCode, 500);
      } catch (err) {
        showError('Unable to access camera. Please grant camera permissions.');
        console.error('Camera error:', err);
      }
    }

    function stopScanning() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }

      if (scanInterval) {
        clearInterval(scanInterval);
        scanInterval = null;
      }

      video.srcObject = null;
      video.classList.add('hidden');
      placeholder.classList.remove('hidden');
      scanning = false;
      scanBtn.textContent = 'Start Scanning';
      scanBtn.classList.remove('button-danger');
      scanBtn.classList.add('button-primary');
    }

    scanBtn.addEventListener('click', () => {
      if (scanning) {
        stopScanning();
      } else {
        startScanning();
      }
    });
  </script>
</body>
</html>