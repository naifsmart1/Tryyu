<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Scan ‚Üí Google Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  #reader {
    width: 300px;
    margin: auto;
  }
  pre {
    background: #f2f2f2;
    padding: 10px;
  }
</style>

<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
</head>
<body>

<h2>QR Scanner ‚Üí Google Sheet</h2>

<button id="startBtn">Start Camera</button>

<div id="reader"></div>

<h3>Status</h3>
<pre id="status">Waiting‚Ä¶</pre>

<script>
/* üî¥ PASTE YOUR APPS SCRIPT WEB APP URL HERE */
const WEB_APP_URL = "PASTE_YOUR_WEB_APP_URL_HERE";

const statusBox = document.getElementById("status");
const startBtn = document.getElementById("startBtn");
let qr;

function log(msg) {
  statusBox.textContent = msg;
}

async function sendToSheet(qrText) {
  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ qr_data: qrText })
    });
    const data = await res.json();
    log("Saved to sheet ‚úÖ\n" + JSON.stringify(data, null, 2));
  } catch (err) {
    log("Error ‚ùå\n" + err);
  }
}

startBtn.onclick = async () => {
  log("Requesting camera permission‚Ä¶");

  try {
    // force permission popup
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    stream.getTracks().forEach(t => t.stop());

    log("Camera permission granted ‚úÖ");

    qr = new Html5Qrcode("reader");
    const cams = await Html5Qrcode.getCameras();

    if (!cams.length) {
      log("No camera found ‚ùå");
      return;
    }

    await qr.start(
      cams[0].id,
      { fps: 10, qrbox: 250 },
      (decodedText) => {
        log("QR Scanned:\n" + decodedText);
        qr.pause();
        sendToSheet(decodedText);
        setTimeout(() => qr.resume(), 2000);
      }
    );

  } catch (err) {
    log("Camera blocked ‚ùå : " + err.name);
  }
};
</script>

</body>
</html>  }
}).catch(err => statusEl.textContent = 'Camera error: '+err);

</script>
  <footer>@Trytech.2025</footer>
</body>
</html>
